!function(e,s){"object"==typeof exports&&"undefined"!=typeof module?s(exports,require("fjage/dist/esm/fjage.js"),require("fjage/dist/esm/fjage")):"function"==typeof define&&define.amd?define(["exports","fjage/dist/esm/fjage.js","fjage/dist/esm/fjage"],s):s((e="undefined"!=typeof globalThis?globalThis:e||self).unet={},e.fjage_js,e.fjage)}(this,(function(e,s,a){"use strict";const t=a.MessageClass("org.arl.unet.DatagramReq"),r=a.MessageClass("org.arl.unet.DatagramNtf"),l=a.MessageClass("org.arl.unet.bb.BasebandSignal");Object.assign(a.Services,{NODE_INFO:"org.arl.unet.Services.NODE_INFO",ADDRESS_RESOLUTION:"org.arl.unet.Services.ADDRESS_RESOLUTION",DATAGRAM:"org.arl.unet.Services.DATAGRAM",PHYSICAL:"org.arl.unet.Services.PHYSICAL",RANGING:"org.arl.unet.Services.RANGING",BASEBAND:"org.arl.unet.Services.BASEBAND",LINK:"org.arl.unet.Services.LINK",MAC:"org.arl.unet.Services.MAC",ROUTING:"org.arl.unet.Services.ROUTING",ROUTE_MAINTENANCE:"org.arl.unet.Services.ROUTE_MAINTENANCE",TRANSPORT:"org.arl.unet.Services.TRANSPORT",REMOTE:"org.arl.unet.Services.REMOTE",STATE_MANAGER:"org.arl.unet.Services.STATE_MANAGER"});let o={DATA:0,RANGING:1,LINK:2,REMOTE:3,MAC:4,ROUTING:5,TRANSPORT:6,ROUTE_MAINTENANCE:7,LINK2:8,USER:32,MAX:63},n={TestReportNtf:a.MessageClass("org.arl.unet.TestReportNtf"),AbnormalTerminationNtf:a.MessageClass("org.arl.unet.AbnormalTerminationNtf"),CapabilityListRsp:a.MessageClass("org.arl.unet.CapabilityListRsp"),CapabilityReq:a.MessageClass("org.arl.unet.CapabilityReq"),ClearReq:a.MessageClass("org.arl.unet.ClearReq"),DatagramCancelReq:a.MessageClass("org.arl.unet.DatagramCancelReq"),DatagramDeliveryNtf:a.MessageClass("org.arl.unet.DatagramDeliveryNtf"),DatagramFailureNtf:a.MessageClass("org.arl.unet.DatagramFailureNtf"),DatagramNtf:a.MessageClass("org.arl.unet.DatagramNtf"),DatagramProgressNtf:a.MessageClass("org.arl.unet.DatagramProgressNtf"),DatagramReq:a.MessageClass("org.arl.unet.DatagramReq"),ParamChangeNtf:a.MessageClass("org.arl.unet.ParamChangeNtf"),RefuseRsp:a.MessageClass("org.arl.unet.RefuseRsp"),FailureNtf:a.MessageClass("org.arl.unet.FailureNtf"),DatagramTraceReq:a.MessageClass("org.arl.unet.net.DatagramTraceReq"),RouteDiscoveryReq:a.MessageClass("org.arl.unet.net.RouteDiscoveryReq"),RouteTraceReq:a.MessageClass("org.arl.unet.net.RouteTraceReq"),RouteDiscoveryNtf:a.MessageClass("org.arl.unet.net.RouteDiscoveryNtf"),RouteTraceNtf:a.MessageClass("org.arl.unet.net.RouteTraceNtf"),FecDecodeReq:a.MessageClass("org.arl.unet.phy.FecDecodeReq"),RxJanusFrameNtf:a.MessageClass("org.arl.unet.phy.RxJanusFrameNtf"),TxJanusFrameReq:a.MessageClass("org.arl.unet.phy.TxJanusFrameReq"),BadFrameNtf:a.MessageClass("org.arl.unet.phy.BadFrameNtf"),BadRangeNtf:a.MessageClass("org.arl.unet.phy.BadRangeNtf"),ClearSyncReq:a.MessageClass("org.arl.unet.phy.ClearSyncReq"),CollisionNtf:a.MessageClass("org.arl.unet.phy.CollisionNtf"),RxFrameNtf:a.MessageClass("org.arl.unet.phy.RxFrameNtf",r),RxFrameStartNtf:a.MessageClass("org.arl.unet.phy.RxFrameStartNtf"),SyncInfoReq:a.MessageClass("org.arl.unet.phy.SyncInfoReq"),SyncInfoRsp:a.MessageClass("org.arl.unet.phy.SyncInfoRsp"),TxFrameNtf:a.MessageClass("org.arl.unet.phy.TxFrameNtf"),TxFrameReq:a.MessageClass("org.arl.unet.phy.TxFrameReq",t),TxFrameStartNtf:a.MessageClass("org.arl.unet.phy.TxFrameStartNtf"),TxRawFrameReq:a.MessageClass("org.arl.unet.phy.TxRawFrameReq"),AddressAllocReq:a.MessageClass("org.arl.unet.addr.AddressAllocReq"),AddressAllocRsp:a.MessageClass("org.arl.unet.addr.AddressAllocRsp"),AddressResolutionReq:a.MessageClass("org.arl.unet.addr.AddressResolutionReq"),AddressResolutionRsp:a.MessageClass("org.arl.unet.addr.AddressResolutionRsp"),BasebandSignal:a.MessageClass("org.arl.unet.bb.BasebandSignal"),RecordBasebandSignalReq:a.MessageClass("org.arl.unet.bb.RecordBasebandSignalReq"),RxBasebandSignalNtf:a.MessageClass("org.arl.unet.bb.RxBasebandSignalNtf",l),TxBasebandSignalReq:a.MessageClass("org.arl.unet.bb.TxBasebandSignalReq",l),LinkStatusNtf:a.MessageClass("org.arl.unet.link.LinkStatusNtf"),RangeNtf:a.MessageClass("org.arl.unet.localization.RangeNtf"),RangeReq:a.MessageClass("org.arl.unet.localization.RangeReq"),BeaconReq:a.MessageClass("org.arl.unet.localization.BeaconReq"),RespondReq:a.MessageClass("org.arl.unet.localization.RespondReq"),InterrogationNtf:a.MessageClass("org.arl.unet.localization.InterrogationNtf"),ReservationAcceptReq:a.MessageClass("org.arl.unet.mac.ReservationAcceptReq"),ReservationCancelReq:a.MessageClass("org.arl.unet.mac.ReservationCancelReq"),ReservationReq:a.MessageClass("org.arl.unet.mac.ReservationReq"),ReservationRsp:a.MessageClass("org.arl.unet.mac.ReservationRsp"),ReservationStatusNtf:a.MessageClass("org.arl.unet.mac.ReservationStatusNtf"),RxAckNtf:a.MessageClass("org.arl.unet.mac.RxAckNtf"),TxAckReq:a.MessageClass("org.arl.unet.mac.TxAckReq"),RemoteExecReq:a.MessageClass("org.arl.unet.remote.RemoteExecReq"),RemoteFailureNtf:a.MessageClass("org.arl.unet.remote.RemoteFailureNtf"),RemoteFileGetReq:a.MessageClass("org.arl.unet.remote.RemoteFileGetReq"),RemoteFileNtf:a.MessageClass("org.arl.unet.remote.RemoteFileNtf"),RemoteFilePutReq:a.MessageClass("org.arl.unet.remote.RemoteFilePutReq"),RemoteSuccessNtf:a.MessageClass("org.arl.unet.remote.RemoteSuccessNtf"),RemoteTextNtf:a.MessageClass("org.arl.unet.remote.RemoteTextNtf"),RemoteTextReq:a.MessageClass("org.arl.unet.remote.RemoteTextReq"),AddScheduledSleepReq:a.MessageClass("org.arl.unet.scheduler.AddScheduledSleepReq"),GetSleepScheduleReq:a.MessageClass("org.arl.unet.scheduler.GetSleepScheduleReq"),RemoveScheduledSleepReq:a.MessageClass("org.arl.unet.scheduler.RemoveScheduledSleepReq"),SleepScheduleRsp:a.MessageClass("org.arl.unet.scheduler.SleepScheduleRsp"),WakeFromSleepNtf:a.MessageClass("org.arl.unet.scheduler.WakeFromSleepNtf"),ClearStateReq:a.MessageClass("org.arl.unet.state.ClearStateReq"),SaveStateReq:a.MessageClass("org.arl.unet.state.SaveStateReq")};const g=n.AddressResolutionReq,i=n.DatagramReq,u=n.DatagramNtf,c=n.RxFrameNtf;Object.defineProperty(e,"Gateway",{enumerable:!0,get:function(){return s.Gateway}}),Object.defineProperty(e,"Message",{enumerable:!0,get:function(){return s.Message}}),Object.defineProperty(e,"MessageClass",{enumerable:!0,get:function(){return s.MessageClass}}),Object.defineProperty(e,"Performative",{enumerable:!0,get:function(){return s.Performative}}),Object.defineProperty(e,"AgentID",{enumerable:!0,get:function(){return a.AgentID}}),Object.defineProperty(e,"Services",{enumerable:!0,get:function(){return a.Services}}),e.Protocol=o,e.UnetMessages=n,e.UnetSocket=class{constructor(e,t,r=""){return(async()=>{this.gw=new s.Gateway({hostname:e,port:t,path:r}),this.localProtocol=-1,this.remoteAddress=-1,this.remoteProtocol=o.DATA,this.timeout=0,this.provider=null;return(await this.gw.agentsForService(a.Services.DATAGRAM)).forEach((e=>{this.gw.subscribe(this.gw.topic(e))})),this})()}close(){this.gw.close(),this.gw=null}isClosed(){return null==this.gw}bind(e){return(e==o.DATA||e>=o.USER&&e<=o.MAX)&&(this.localProtocol=e,!0)}unbind(){this.localProtocol=-1}isBound(){return this.localProtocol>=0}connect(e,s){return e>=0&&(s==o.DATA||s>=o.USER&&s<=o.MAX)&&(this.remoteAddress=e,this.remoteProtocol=s,!0)}disconnect(){this.remoteAddress=-1,this.remoteProtocol=0}isConnected(){return this.remoteAddress>=0}async getLocalAddress(){if(null==this.gw)return-1;const e=await this.gw.agentForService(a.Services.NODE_INFO);if(null==e)return-1;const s=await e.get("address");return null!=s?s:-1}getLocalProtocol(){return this.localProtocol}getRemoteAddress(){return this.remoteAddress}getRemoteProtocol(){return this.remoteProtocol}setTimeout(e){e<0&&(e=0),this.timeout=e}getTimeout(){return this.timeout}async send(e,t=this.remoteAddress,r=this.remoteProtocol){if(t<0||null==this.gw)return!1;var l;if(Array.isArray(e))(l=new i).data=e,l.to=t,l.protocol=r;else{if(!(e instanceof i))return!1;l=e}let n=l.protocol;if(n!=o.DATA&&(n<o.USER||n>o.MAX))return!1;if(null==l.recipient){if(null==this.provider&&(this.provider=await this.gw.agentForService(a.Services.TRANSPORT)),null==this.provider&&(this.provider=await this.gw.agentForService(a.Services.ROUTING)),null==this.provider&&(this.provider=await this.gw.agentForService(a.Services.LINK)),null==this.provider&&(this.provider=await this.gw.agentForService(a.Services.PHYSICAL)),null==this.provider&&(this.provider=await this.gw.agentForService(a.Services.DATAGRAM)),null==this.provider)return!1;l.recipient=this.provider}const g=await this.gw.request(l,1e3);return null!=g&&g.perf==s.Performative.AGREE}async receive(){return null==this.gw?null:await this.gw.receive((e=>{if(e.__clazz__!=u.__clazz__&&e.__clazz__!=c.__clazz__)return!1;let s=e.protocol;return(s==o.DATA||s>=o.USER)&&(this.localProtocol<0||this.localProtocol==s)}),this.timeout)}getGateway(){return this.gw}async agentForService(e){return null==this.gw?null:await this.gw.agentForService(e)}async agentsForService(e){return null==this.gw?null:await this.gw.agentsForService(e)}agent(e){return null==this.gw?null:this.gw.agent(e)}async host(e){const s=await this.agentForService(a.Services.ADDRESS_RESOLUTION);if(null==s)return null;const t=new g(e);t.name=e,t.recipient=s;const r=await this.gw.request(t,1e3);return null!=r&&Object.prototype.hasOwnProperty.call(r,"address")?r.address:null}}}));
//# sourceMappingURL=unetjs.min.js.map
